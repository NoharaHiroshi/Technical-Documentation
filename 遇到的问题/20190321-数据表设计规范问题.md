#20190321-数据表设计规范问题#

## 问题背景描述 ##

因为设计数据表的原因被喷的很惨，主要是因为对方主张各实体之间分别存放一张表，然后再创建一张关系表来关联两个实体之间的关系。而我的主张是，因为这两张表有关联关系，其中一张表从属于另一张表，父表与子表是一对多的关系，那么关联关系写在子表中。

**业务逻辑**： 电子签约中，客户需要申请证书才能签约，签约会用到不同种类的证书，例如代表公章的证书和代表法人章的证书，不同种类的证书只能申请一种。而客户下又包含下属机构，有些协议需要下属机构的证书去签约，下属机构又包含多种种类不同的证书，而所有的证书都由主体客户来管理。

**以下是我设计的表结构（部分字段）**

客户表 customer

	int id;			// 主键
	String name; 	// 客户名称
	
客户下属机构 subBody
	
	int id;			// 主键
	String name; 	// 下属机构名称
	int custId;		// 客户ID

证书 certificate

	int id; 		// 主键
	int custId;		// 客户ID
	String name;	// 证书名称
	String type;	// 证书种类
	int subBodyId;	// 下属机构ID


**以下是对方设计的表结构（部分字段）**

客户表 customer

	int id;
	String name; 	// 客户名称
	
客户下属机构 subBody
	
	int id;
	String name; 	// 下属机构名称

客户下属机构关联关系 customerSubBodyRel
	
	int custId; 	// 主键
	int subBodyId	// 下属机构Id

证书 certificate

	int id; 
	String name;	// 证书名称
	String type;	// 证书种类

客户证书关联关系 customerCertRel

	int custId;		// 主键
	int certId;		// 证书Id

下属机构证书关联关系 subBodyCertRel

	int subBodyId	// 主键
	int certId;		// 证书Id

**我的理由**

**逻辑角度**，关联关系是否作为表结构的一部分，是要看和关联对象的关系是否足够紧密，是否是对象结构的一部分。 比如说下属机构，它脱离主体机构是没有意义的。 即使后续它还要和别的对象关联，但我也必须要知道这个下属机构从属于哪个主体，那么这个客户id就是下属机构的一个属性，所以放在一张表里。

**性能角度**，查找双方的关联关系势必就要联表，比如说我要查找客户下的下属机构

	select * from subBody where custId = #{custId};

如果把关联关系单独放在一张表。
	
	select subBody.* from subBody join customerSubBodyRel on subBody.id = customerSubBodyRel.subBodyId where customerSubBodyRel.custId = #{custId};

联表的开销还是比较大的，至少远比多存一个字段的开销要大。

**对方的理由**

**逻辑角度**，主体是主体，它是现实事物的映射，就像老师与学生，老师实体就是老师，学生实体就是学生，至于关联关系要单独存放。（嗯，这是没有问题的，我也认同，但要分情况，像学生，它并不依附于老师，例如我查询成绩的时候也不需要知道这个学生的老师是谁，但是下属机构不同，我查询下属机构的时候必须要知道它的主体是谁）

**性能角度**，你知道增加字段每次更新/写入/查询都是有开销的吗？例如我只想查下属机构，你却带了一堆我不需要的字段来。（我增加的都是关联表的主键啊，我也不会在机构表中加上客户的名称啊，这样就相当于只增加了主键的字段，另外这样节省下来联表的开销啊！(｡・`ω´･)，另外每次我查询客户下的下属机构都要联表，我累不累啊，如果保存客户下的下属机构的证书，那是只存客户和证书的关联关系，还是下属机构和证书的关系，客户证书关联也要保存？那样简直乱套了）

呼~ 对方在提出不同意见时，我也会仔细考虑对方说的是否有道理，但是要考虑实际业务场景，不能一概而论，照本宣科。

## 解决问题方案 ##

我要淡定。